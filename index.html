<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { 
            --bg: #0b0e11; --card: rgba(23, 29, 37, 0.6); --accent: #f0b90b; 
            --red: #f6465d; --green: #0ecb81; --border: rgba(255, 255, 255, 0.08); 
        }
        
        body { 
            background: var(--bg); color: #eaecef; font-family: 'Inter', sans-serif; 
            margin: 0; padding: 0; height: 100vh; overflow: hidden;
            background-image: radial-gradient(circle at 50% 0%, #1e1a0a 0%, #0b0e11 100%);
        }

        .screen { display: none; flex-direction: column; height: 100vh; padding: 20px; box-sizing: border-box; overflow-y: auto; backdrop-filter: blur(15px); }
        .active { display: flex; }

        .card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 18px; margin-bottom: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
        
        .stat-item { background: rgba(0,0,0,0.2); padding: 12px; border-radius: 12px; border: 1px solid var(--border); }
        .stat-item label { font-size: 10px; color: #848e9c; display: block; margin-bottom: 4px; text-transform: uppercase; }
        .stat-item span { font-size: 14px; font-weight: bold; color: var(--accent); }

        .btn-main { 
            background: linear-gradient(90deg, #f0b90b, #f8d33a); color: #000; border: none;
            padding: 18px; border-radius: 14px; font-weight: 800; font-size: 15px;
            cursor: pointer; width: 100%; transition: 0.2s;
        }
        .btn-main:active { transform: translateY(2px); opacity: 0.9; }
        
        .btn-outline { background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: #fff; padding: 14px; border-radius: 12px; cursor: pointer; font-weight: 600; }

        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
        .day { aspect-ratio: 1; background: rgba(255,255,255,0.03); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 13px; color: #5e6673; transition: 0.3s; }
        .day.done { background: var(--red) !important; color: #fff; box-shadow: 0 0 15px rgba(246, 70, 93, 0.3); }
        .day.today { border: 1px solid var(--accent); color: var(--accent); font-weight: bold; }

        .back-btn { color: #848e9c; cursor: pointer; margin-bottom: 20px; display: inline-block; }
        input { background: rgba(0,0,0,0.4); border: 1px solid var(--border); color: #fff; padding: 14px; border-radius: 10px; margin-bottom: 12px; width: 100%; box-sizing: border-box; outline: none; }
        input:focus { border-color: var(--accent); }
    </style>
</head>
<body>

    <div id="scr-main" class="screen active">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
            <h2 style="margin:0; letter-spacing: 1px;">SMC <span style="color:var(--accent)">QUANTUM</span></h2>
            <div id="fng-val" style="background: rgba(14,203,129,0.1); color: var(--green); padding: 5px 12px; border-radius: 10px; font-size: 12px; font-weight: bold;">F&G: 65</div>
        </div>

        <div class="card" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div class="stat-item"><label>–§–∞–∑–∞ —Ä—ã–Ω–∫–∞</label><span id="ui-phase">–û–ñ–ò–î–ê–ù–ò–ï</span></div>
            <div class="stat-item"><label>–°—Ç–∞—Ç—É—Å</label><span id="ui-deal">–ù–ï–¢ –°–î–ï–õ–ö–ò</span></div>
            <div class="stat-item" style="grid-column: span 2;"><label>–î–µ—Ç–∞–ª–∏ –ø–æ–∑–∏—Ü–∏–∏</label><span id="ui-details">-</span></div>
        </div>

        <button class="btn-main" onclick="nav('scr-analysis')">üîç –¢–û–†–ì–û–í–´–ô –ê–ù–ê–õ–ò–ó</button>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px;">
            <button class="btn-outline" onclick="nav('scr-terminal')">üìä –ì–†–ê–§–ò–ö</button>
            <button class="btn-outline" onclick="nav('scr-calendar')">üìÖ –ñ–£–†–ù–ê–õ</button>
        </div>
        <button class="btn-outline" onclick="nav('scr-info')" style="width: 100%; margin-top: 12px;">üåç –ú–ê–ö–†–û–î–ê–ù–ù–´–ï</button>
    </div>

    <div id="scr-calendar" class="screen">
        <div class="back-btn" onclick="nav('scr-main')">‚Üê –ù–ê –ì–õ–ê–í–ù–£–Æ</div>
        <div class="card">
            <div class="cal-header">
                <button onclick="changeMonth(-1)" class="btn-outline" style="padding: 5px 15px;">‚ùÆ</button>
                <b id="month-name" style="font-size: 18px;"></b>
                <button onclick="changeMonth(1)" class="btn-outline" style="padding: 5px 15px;">‚ùØ</button>
            </div>
            <div id="cal-render" class="cal-grid"></div>
        </div>
    </div>

    <div id="scr-analysis" class="screen">
        <div class="back-btn" onclick="nav('scr-main')">‚Üê –û–¢–ú–ï–ù–ê</div>
        <div id="flow-content"></div>
    </div>

    <div id="scr-info" class="screen">
        <div class="back-btn" onclick="nav('scr-main')">‚Üê –ù–ê–ó–ê–î</div>
        <div id="econ-container" style="height: 450px; border-radius: 15px; overflow: hidden; border: 1px solid var(--border);"></div>
        <button class="btn-main" onclick="window.open('https://t.me/realDonaldTrump_rus')" style="margin-top: 20px; background: #0088cc; color: #fff;">
            REAL DONALD TRUMP (RU)
        </button>
    </div>

    <div id="scr-terminal" class="screen">
        <div class="back-btn" onclick="nav('scr-main')">‚Üê –ù–ê–ó–ê–î</div>
        <div id="tv-chart" style="height: 500px;"></div>
    </div>

    <script src="https://s3.tradingview.com/tv.js"></script>
    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let viewDate = new Date();
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ URL (–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—Å–ª–∞–ª –±–æ—Ç –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ)
        let state = {
            history: (new URLSearchParams(window.location.search).get('dates') || "").split(',').filter(d => d),
            phase: '–û–∂–∏–¥–∞–Ω–∏–µ',
            dealStatus: '–ù–µ—Ç —Å–¥–µ–ª–∫–∏',
            details: '-'
        };

        function nav(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'scr-calendar') renderCal();
            if(id === 'scr-info') initEcon();
            if(id === 'scr-analysis') showStep('init');
            if(id === 'scr-terminal') new TradingView.widget({"autosize": true, "symbol": "BINANCE:BTCUSDT", "interval": "15", "theme": "dark", "container_id": "tv-chart"});
        }

        // --- –ë–ï–°–ö–û–ù–ï–ß–ù–´–ô –ö–ê–õ–ï–ù–î–ê–†–¨ ---
        function renderCal() {
            const grid = document.getElementById('cal-render');
            grid.innerHTML = '';
            const y = viewDate.getFullYear(), m = viewDate.getMonth();
            document.getElementById('month-name').innerText = new Intl.DateTimeFormat('ru-RU', {month:'long', year:'numeric'}).format(viewDate);
            
            const first = new Date(y, m, 1).getDay();
            const days = new Date(y, m + 1, 0).getDate();
            const offset = (first === 0 ? 6 : first - 1);

            for(let i=0; i<offset; i++) grid.innerHTML += '<div></div>';
            for(let d=1; d<=days; d++) {
                const dStr = `${y}-${(m+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`;
                const isDone = state.history.includes(dStr) ? 'done' : '';
                const isToday = new Date().toISOString().slice(0,10) === dStr ? 'today' : '';
                grid.innerHTML += `<div class="day ${isDone} ${isToday}">${d}</div>`;
            }
        }
        function changeMonth(v) { viewDate.setMonth(viewDate.getMonth() + v); renderCal(); }

        // --- –û–ü–†–û–° ---
        function showStep(step) {
            const flow = document.getElementById('flow-content');
            if(step === 'init') {
                flow.innerHTML = `<h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–∑—É:</h3>
                    <button class="btn-main" onclick="state.phase='–ö–æ—Ä—Ä–µ–∫—Ü–∏—è'; showStep('correction')">–§–ê–ó–ê –ö–û–†–†–ï–ö–¶–ò–ò</button>
                    <button class="btn-main" onclick="state.phase='–ò–º–ø—É–ª—å—Å'; showStep('impulse')" style="margin-top:10px; background:#444; color:#fff;">–§–ê–ó–ê –ò–ú–ü–£–õ–¨–°–ê</button>`;
            } else if(step === 'impulse') {
                state.dealStatus = '–û–∂–∏–¥–∞–Ω–∏–µ';
                flow.innerHTML = `<div class="card"><h3>–°—Ç–∞—Ç—É—Å: –û–ñ–ò–î–ê–ù–ò–ï</h3><p>–ñ–¥–µ–º —Ñ–∞–∑—É –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ –¢–í–•.</p></div>
                    <button class="btn-main" onclick="state.phase='–ö–æ—Ä—Ä–µ–∫—Ü–∏—è'; showStep('correction')">–ü–ï–†–ï–®–õ–ò –í –ö–û–†–†–ï–ö–¶–ò–Æ</button>
                    <button class="btn-outline" onclick="saveAndStay()" style="width:100%; margin-top:10px;">–ü–û–î–¢–í–ï–†–î–ò–¢–¨ –ò –í–ï–†–ù–£–¢–¨–°–Ø</button>`;
            } else if(step === 'correction') {
                state.dealStatus = '–û–∂–∏–¥–∞–Ω–∏–µ –≤—Ö–æ–¥–∞';
                flow.innerHTML = `<div class="card"><h3>–°—Ç–∞—Ç—É—Å: –ü–û–ò–°–ö –í–•–û–î–ê</h3><p>–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞.</p></div>
                    <button class="btn-main" onclick="showStep('form')">–ï–°–¢–¨ –í–•–û–î (SMC)</button>
                    <button class="btn-outline" onclick="saveAndStay()" style="width:100%; margin-top:10px;">–í–•–û–î–ê –ù–ï–¢</button>`;
            } else if(step === 'form') {
                flow.innerHTML = `<h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–¥–µ–ª–∫–∏:</h3>
                    <input id="in-e" type="number" placeholder="–í—Ö–æ–¥ (Price)">
                    <input id="in-sl" type="number" placeholder="Stop Loss">
                    <input id="in-rr" placeholder="RR (–Ω–∞–ø—Ä. 1:3)">
                    <button class="btn-main" onclick="submitDeal()">–û–¢–ö–†–´–¢–¨ –ü–û–ó–ò–¶–ò–Æ</button>`;
            }
            updateUI();
        }

        function submitDeal() {
            state.dealStatus = '–í –°–î–ï–õ–ö–ï';
            state.details = `E: ${document.getElementById('in-e').value} | SL: ${document.getElementById('in-sl').value} | RR: ${document.getElementById('in-rr').value}`;
            saveAndStay();
        }

        function updateUI() {
            document.getElementById('ui-phase').innerText = state.phase;
            document.getElementById('ui-deal').innerText = state.dealStatus;
            document.getElementById('ui-details').innerText = state.details;
        }

        // –ì–õ–ê–í–ù–´–ô –§–ò–ö–°: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ë–ï–ó –∑–∞–∫—Ä—ã—Ç–∏—è
        function saveAndStay() {
            const today = new Date().toISOString().slice(0,10);
            if(!state.history.includes(today)) state.history.push(today);
            
            updateUI();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ CloudStorage Telegram (—ç—Ç–æ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –æ–∫–Ω–æ!)
            if (tg.CloudStorage) {
                tg.CloudStorage.setItem('trading_state', JSON.stringify(state));
            }

            // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ—Ç—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ fetch, –µ—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä
            // –ù–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏ ‚Äî –º—ã –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
            nav('scr-main');
            tg.HapticFeedback.notificationOccurred('success');
        }

        function initEcon() {
            const cont = document.getElementById('econ-container');
            cont.innerHTML = '';
            const script = document.createElement('script');
            script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-events.js';
            script.async = true;
            script.text = JSON.stringify({colorTheme: "dark", width: "100%", height: "100%", locale: "ru", importanceFilter: "0,1"});
            cont.appendChild(script);
        }

        // Fear & Greed
        fetch('https://api.alternative.me/fng/').then(r=>r.json()).then(d=>{
            document.getElementById('fng-val').innerText = `F&G: ${d.data[0].value}`;
        });
    </script>
</body>
</html>