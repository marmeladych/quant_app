<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #000; --card: #111; --accent: #f0b90b; --red: #ff4444; --border: #222; }
        body { background: var(--bg); color: #fff; font-family: -apple-system, sans-serif; margin: 0; padding: 0; height: 100vh; overflow: hidden; }
        .screen { display: none; flex-direction: column; height: 100vh; padding: 15px; box-sizing: border-box; overflow-y: auto; }
        .active { display: flex; }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .btn-main { background: var(--card); border: 1px solid var(--border); color: #fff; padding: 18px; border-radius: 12px; margin-bottom: 10px; font-weight: bold; text-align: left; display: flex; justify-content: space-between; border-left: 5px solid var(--accent); width: 100%; }
        
        /* –°—Ç–∞—Ç—É—Å —Å–¥–µ–ª–∫–∏ */
        .trade-status { background: #1a1a1a; border: 1px solid var(--accent); border-radius: 10px; padding: 12px; margin-bottom: 15px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; font-size: 11px; text-align: center; }
        .trade-status b { display: block; font-size: 14px; color: var(--accent); }

        /* –¢–µ—Ä–º–∏–Ω–∞–ª */
        #tv-chart { flex-grow: 1; min-height: 350px; border: 1px solid var(--border); border-radius: 10px; }
        .notes { background: #000; border: 1px solid var(--border); color: #fff; padding: 10px; height: 50px; border-radius: 8px; margin-top: 8px; font-size: 12px; width: 100%; box-sizing: border-box; }

        /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å –¥–æ 2100 –≥–æ–¥–∞ */
        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
        .day { aspect-ratio: 1; background: #111; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 10px; border: 1px solid #222; }
        .day.today { border-color: var(--accent); color: var(--accent); }
        .day.done { background: var(--red); color: #fff; border-color: var(--red); box-shadow: 0 0 8px var(--red); }

        /* –ò–Ω—Ñ–æ */
        .info-card { background: var(--card); padding: 12px; border-radius: 12px; margin-bottom: 10px; border: 1px solid var(--border); }
        .trump-post { font-size: 12px; color: #eee; padding: 8px; border-left: 2px solid #444; margin-bottom: 8px; background: #000; }
        .back { color: var(--accent); font-weight: bold; margin-bottom: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="scr-main" class="screen active">
        <h1 style="font-size: 24px;">SMC <span style="color:var(--accent)">QUANTUM</span></h1>
        
        <div class="trade-status">
            <div>SIDE<b id="st-side">WAIT</b></div>
            <div>ENTRY<b id="st-entry">0.00</b></div>
            <div>TP/SL<b id="st-tpsl">0/0</b></div>
        </div>

        <button class="btn-main" onclick="nav('scr-analysis')">üîç –ê–ù–ê–õ–ò–ó 4H <span>‚Üí</span></button>
        <button class="btn-main" style="border-left-color: var(--red)" onclick="nav('scr-info')">üåç NEWS & MACRO <span>‚Üí</span></button>
        <button class="btn-main" style="border-left-color: #fff" onclick="nav('scr-terminal')">üìä –¢–ï–†–ú–ò–ù–ê–õ <span>‚Üí</span></button>
        <button class="btn-main" style="border-left-color: #555" onclick="nav('scr-calendar')">üìÖ –ö–ê–õ–ï–ù–î–ê–†–¨ 2100 <span>‚Üí</span></button>
    </div>

    <div id="scr-terminal" class="screen">
        <span class="back" onclick="nav('scr-main')">‚Üê BACK</span>
        <div id="tv-chart"></div>
        <textarea class="notes" id="note-box" placeholder="–ó–∞–º–µ—Ç–∫–∏..." oninput="localStorage.setItem('smc_note', this.value)"></textarea>
    </div>

    <div id="scr-calendar" class="screen">
        <span class="back" onclick="nav('scr-main')">‚Üê BACK</span>
        <div class="info-card">
            <div class="cal-header">
                <button onclick="changeMonth(-1)" style="background:none; border:none; color:#fff;">‚ùÆ</button>
                <b id="month-name">–Ø–Ω–≤–∞—Ä—å 2026</b>
                <button onclick="changeMonth(1)" style="background:none; border:none; color:#fff;">‚ùØ</button>
            </div>
            <div id="cal-render" class="cal-grid"></div>
        </div>
    </div>

    <div id="scr-info" class="screen">
        <span class="back" onclick="nav('scr-main')">‚Üê BACK</span>
        
        <div class="info-card">
            <small>FEAR & GREED</small>
            <div id="fng-val" style="font-size: 20px; font-weight: bold; color: var(--accent);">...</div>
        </div>

        <div class="info-card">
            <small>TRUMP STATEMENTS</small>
            <div id="trump-feed" style="margin-top:10px;"></div>
        </div>

        <div class="info-card">
            <small>MACRO WEEK (USA)</small>
            <div style="font-size: 12px; margin-top:5px; line-height: 1.6;">
                üü¢ –°—Ä–µ–¥–∞: CPI (–ò–Ω—Ñ–ª—è—Ü–∏—è) 16:30<br>
                üî¥ –ß–µ—Ç–≤–µ—Ä–≥: PPI / Claims 16:30<br>
                üü° –ü—è—Ç–Ω–∏—Ü–∞: Michigan Consumer Sent.
            </div>
        </div>
    </div>

    <div id="scr-analysis" class="screen">
        <span class="back" onclick="nav('scr-main')">‚Üê BACK</span>
        <div class="info-card" id="poll-box">
            <h3>Daily Analysis Check</h3>
            <p>–í—ã –ø—Ä–æ–≤–µ–ª–∏ —Ä–∞–∑–±–æ—Ä 4H —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏?</p>
            <button class="btn-main" style="background:var(--accent); color:#000; justify-content:center;" onclick="confirmAnalysis()">–î–ê, –ü–û–î–¢–í–ï–†–ñ–î–ê–Æ</button>
        </div>
    </div>

    <script src="https://s3.tradingview.com/tv.js"></script>
    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let currentViewDate = new Date();
        const urlParams = new URLSearchParams(window.location.search);
        let history = (urlParams.get('dates') || "").split(',');
        const trumpData = (urlParams.get('posts') || "").split('|');

        function nav(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'scr-terminal') initChart();
            if(id === 'scr-calendar') renderCalendar();
            if(id === 'scr-info') { loadFNG(); renderTrump(); }
        }

        function initChart() {
            new TradingView.widget({
                "autosize": true, "symbol": "BINANCE:BTCUSDT", "interval": "15",
                "theme": "dark", "container_id": "tv-chart", "hide_top_toolbar": false
            });
            document.getElementById('note-box').value = localStorage.getItem('smc_note') || '';
        }

        // –ö–∞–ª–µ–Ω–¥–∞—Ä—å –¥–æ 2100 –≥–æ–¥–∞
        function renderCalendar() {
            const grid = document.getElementById('cal-render');
            grid.innerHTML = '';
            const y = currentViewDate.getFullYear();
            const m = currentViewDate.getMonth();
            document.getElementById('month-name').innerText = new Intl.DateTimeFormat('ru-RU', {month:'long', year:'numeric'}).format(currentViewDate);

            const firstDay = new Date(y, m, 1).getDay();
            const daysInMonth = new Date(y, m + 1, 0).getDate();

            for(let i=0; i < (firstDay === 0 ? 6 : firstDay - 1); i++) grid.innerHTML += '<div></div>';
            
            for(let d=1; d<=daysInMonth; d++) {
                const dateStr = `${y}-${(m+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`;
                const isDone = history.includes(dateStr);
                const isToday = new Date().toISOString().slice(0,10) === dateStr;
                grid.innerHTML += `<div class="day ${isDone ? 'done' : ''} ${isToday ? 'today' : ''}">${d}</div>`;
            }
        }

        function changeMonth(delta) {
            currentViewDate.setMonth(currentViewDate.getMonth() + delta);
            renderCalendar();
        }

        function renderTrump() {
            const f = document.getElementById('trump-feed');
            f.innerHTML = trumpData.filter(p => p.length > 5).map(p => `<div class="trump-post">${p}</div>`).join('');
        }

        function loadFNG() {
            fetch('https://api.alternative.me/fng/').then(r=>r.json()).then(d=>{
                document.getElementById('fng-val').innerText = d.data[0].value + ' (' + d.data[0].value_classification + ')';
            });
        }

        function confirmAnalysis() {
            const today = new Date().toISOString().slice(0,10);
            if(!history.includes(today)) history.push(today);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –±–æ—Ç—É —á–µ—Ä–µ–∑ sendData (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä–æ–µ—Ç—Å—è, –Ω–æ –¥–∞—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –±–æ—Ç–µ)
            tg.sendData(JSON.stringify({action: 'analysis_done', date: today}));
            
            document.getElementById('poll-box').innerHTML = "<h3>‚úÖ –£—Å–ø–µ—à–Ω–æ!</h3><p>–î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã. –ù–∞–∂–º–∏—Ç–µ BACK.</p>";
            renderCalendar();
        }

        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        document.getElementById('st-side').innerText = urlParams.get('side') || 'WAIT';
        document.getElementById('st-entry').innerText = urlParams.get('entry') || '0.00';
    </script>
</body>
</html>