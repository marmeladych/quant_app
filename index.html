<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SMC Quantum v2</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { 
            --bg: #080a0c; --card: #12161c; --accent: #f0b90b; 
            --green: #0ecb81; --red: #f6465d; --text: #eaecef; 
            --border: #2b3139; --shadow: rgba(0,0,0,0.5);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 15px; overflow-x: hidden; }
        
        .screen { display: none; animation: fadeIn 0.3s ease; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* –ö–ù–û–ü–ö–ò –ú–ï–ù–Æ */
        .main-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 20px; }
        .btn-nav { 
            background: linear-gradient(145deg, #1e2329, #12161c); 
            border: 1px solid var(--border); color: white; height: 100px; 
            border-radius: 20px; font-size: 18px; font-weight: 700; cursor: pointer;
            box-shadow: 0 4px 15px var(--shadow); transition: 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-nav:active { transform: scale(0.98); border-color: var(--accent); color: var(--accent); }

        /* –ö–ê–†–¢–û–ß–ö–ò */
        .glass-card { 
            background: var(--card); border: 1px solid var(--border); 
            border-radius: 16px; padding: 15px; margin-bottom: 15px;
            box-shadow: 0 8px 32px var(--shadow);
        }

        /* –ö–ê–õ–ï–ù–î–ê–†–¨ */
        .calendar-grid { 
            display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; 
            background: #1e2329; padding: 10px; border-radius: 12px; margin-top: 10px;
        }
        .cal-day { 
            aspect-ratio: 1; display: flex; align-items: center; justify-content: center; 
            font-size: 12px; color: #848e9c; border-radius: 6px; position: relative;
        }
        .cal-day.has-analysis::after {
            content: ''; position: absolute; bottom: 4px; width: 6px; height: 6px; 
            background: var(--red); border-radius: 50%; box-shadow: 0 0 8px var(--red);
        }
        .cal-header { font-weight: bold; color: var(--accent); font-size: 10px; text-transform: uppercase; text-align: center; }

        /* –ì–†–ê–§–ò–ö */
        #tv_chart { height: 260px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 15px; }

        /* –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–û–ï */
        .btn-back { background: none; border: none; color: var(--accent); font-weight: bold; cursor: pointer; padding: 10px 0; display: flex; align-items: center; gap: 5px; }
        .accent-text { color: var(--accent); }
        .status-badge { padding: 4px 8px; border-radius: 6px; font-size: 12px; background: rgba(240, 185, 11, 0.1); color: var(--accent); border: 1px solid rgba(240, 185, 11, 0.2); }
    </style>
</head>
<body>

    <div id="scr-main" class="screen active">
        <div style="text-align:center; margin-bottom: 30px;">
            <h1 style="font-size: 24px; margin: 0; letter-spacing: 1px;">SMC <span class="accent-text">QUANTUM</span></h1>
            <p style="color: #848e9c; font-size: 14px;">–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã</p>
        </div>
        
        <div class="main-grid">
            <button class="btn-nav" onclick="showScreen('scr-terminal')">üìä –¢–ï–†–ú–ò–ù–ê–õ</button>
            <button class="btn-nav" onclick="showScreen('scr-analysis')">üîç –ê–ù–ê–õ–ò–ó (4H)</button>
        </div>
    </div>

    <div id="scr-terminal" class="screen">
        <button class="btn-back" onclick="showScreen('scr-main')">‚Üê –ù–ê–ó–ê–î</button>
        <div id="tv_chart"></div>
        <div class="glass-card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div><div style="font-size: 10px; color:#848e9c;">–¢–ï–ö–£–©–ò–ô –°–ò–ì–ù–ê–õ</div><div id="side-ui" style="font-size: 20px; font-weight: bold;">WAIT</div></div>
                <div><div style="font-size: 10px; color:#848e9c;">–¶–ï–ù–ê –í–•–û–î–ê</div><div id="entry-ui" style="font-size: 20px; font-weight: bold; font-family: monospace;">0.00</div></div>
            </div>
        </div>
    </div>

    <div id="scr-analysis" class="screen">
        <button class="btn-back" onclick="showScreen('scr-main')">‚Üê –ù–ê–ó–ê–î</button>
        
        <div id="analysis-flow">
            <div id="a1" class="glass-card">
                <h3>–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä—É—Ç–∏–Ω–∞</h3>
                <p style="color: #848e9c; font-size: 14px;">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–∞ 4H —Ç–∞–π–º—Ñ—Ä–µ–π–º–µ –ø–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º –≤—Ö–æ–¥–∞.</p>
                <button class="btn-nav" style="height: 60px; font-size: 16px; background: var(--accent); color: black;" onclick="nextStep(2)">–ù–ê–ß–ê–¢–¨ –ê–ù–ê–õ–ò–ó</button>
                <button class="btn-nav" style="height: 50px; font-size: 14px; margin-top: 10px;" onclick="toggleHistory()">üìÖ –ò–°–¢–û–†–ò–Ø –ò –ö–ê–õ–ï–ù–î–ê–†–¨</button>
            </div>

            <div id="a2" class="glass-card" style="display:none;">
                <h3>–¢–µ–∫—É—â–∞—è —Ñ–∞–∑–∞ —Ä—ã–Ω–∫–∞</h3>
                <button class="btn-nav" style="height: 60px;" onclick="finish('–ö–æ—Ä—Ä–µ–∫—Ü–∏—è', '–û–∂–∏–¥–∞–Ω–∏–µ')">–ö–û–†–†–ï–ö–¶–ò–Ø</button>
                <button class="btn-nav" style="height: 60px; color: var(--green);" onclick="nextStep(3)">–ò–ú–ü–£–õ–¨–°</button>
            </div>

            <div id="a3" class="glass-card" style="display:none;">
                <h3>–ü–æ–∏—Å–∫ –≤—Ö–æ–¥–∞ (LTF)</h3>
                <button class="btn-nav" style="height: 60px; color: var(--green);" onclick="finish('–ò–º–ø—É–ª—å—Å', '–ü–æ–∏—Å–∫ –≤—Ö–æ–¥–∞')">–ï–°–¢–¨ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï</button>
                <button class="btn-nav" style="height: 60px;" onclick="finish('–ò–º–ø—É–ª—å—Å', '–û–∂–∏–¥–∞–Ω–∏–µ')">–ù–ï–¢ –í–•–û–î–ê</button>
            </div>
        </div>

        <div id="history-view" style="display:none;">
            <div class="glass-card">
                <div style="display:flex; justify-content: space-between;">
                    <span style="font-weight:bold;">–Ø–Ω–≤–∞—Ä—å 2026</span>
                    <span class="status-badge" onclick="toggleHistory()">–ö –ê–ù–ê–õ–ò–ó–£</span>
                </div>
                <div class="calendar-grid" id="calendar-days">
                    </div>
            </div>
            <div id="log-list"></div>
        </div>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'scr-terminal') {
                new TradingView.widget({ "autosize": true, "symbol": "BINANCE:BTCUSDT", "interval": "15", "theme": "dark", "container_id": "tv_chart", "hide_top_toolbar": true });
            }
        }

        function nextStep(n) {
            document.getElementById('a1').style.display = 'none';
            document.getElementById('a2').style.display = 'none';
            document.getElementById('a3').style.display = 'none';
            document.getElementById('a' + n).style.display = 'block';
        }

        function toggleHistory() {
            const flow = document.getElementById('analysis-flow');
            const history = document.getElementById('history-view');
            if(flow.style.display === 'none') {
                flow.style.display = 'block';
                history.style.display = 'none';
            } else {
                flow.style.display = 'none';
                history.style.display = 'block';
                renderCalendar();
            }
        }

        function finish(p, s) {
            tg.sendData(JSON.stringify({type: 'analysis', phase: p, status: s}));
            tg.close();
        }

        function renderCalendar() {
            const grid = document.getElementById('calendar-days');
            grid.innerHTML = '';
            const days = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
            days.forEach(d => grid.innerHTML += `<div class="cal-header">${d}</div>`);
            
            // –ó–∞–≥–ª—É—à–∫–∞: –∑–∞–∫—Ä–∞—à–∏–≤–∞–µ–º "—Å–µ–≥–æ–¥–Ω—è" –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ (13-–µ —á–∏—Å–ª–æ)
            for(let i = 1; i <= 31; i++) {
                let activeClass = (i === 13) ? 'has-analysis' : '';
                grid.innerHTML += `<div class="cal-day ${activeClass}">${i}</div>`;
            }
        }

        const p = new URLSearchParams(window.location.search);
        document.getElementById('side-ui').innerText = p.get('side') || 'WAIT';
        document.getElementById('entry-ui').innerText = p.get('entry') || '0.00';
    </script>
</body>
</html>