<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #000; --card: #111; --accent: #f0b90b; --red: #ff4444; --border: #222; }
        body { background: var(--bg); color: #fff; font-family: -apple-system, sans-serif; margin: 0; padding: 0; overflow: hidden; }
        
        .screen { display: none; flex-direction: column; height: 100vh; padding: 15px; box-sizing: border-box; }
        .active { display: flex; }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .btn-main { background: var(--card); border: 1px solid var(--border); color: #fff; padding: 20px; border-radius: 15px; margin-bottom: 10px; font-size: 18px; font-weight: bold; text-align: left; display: flex; justify-content: space-between; border-left: 5px solid var(--accent); }
        .btn-sub { background: var(--card); border: 1px solid var(--border); color: #ccc; padding: 15px; border-radius: 12px; font-size: 14px; font-weight: bold; flex: 1; }

        /* –¢–µ—Ä–º–∏–Ω–∞–ª: –ì—Ä–∞—Ñ–∏–∫ */
        #tv-chart { flex-grow: 1; border: 1px solid var(--border); border-radius: 12px; }
        .notes { background: #000; border: 1px solid var(--border); color: #fff; padding: 10px; height: 60px; border-radius: 8px; margin-top: 10px; resize: none; font-size: 12px; }

        /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å */
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; margin-top: 15px; }
        .day { aspect-ratio: 1; background: #151515; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #444; }
        .day.done { border: 1px solid var(--red); color: #fff; box-shadow: 0 0 10px rgba(255, 68, 68, 0.3); }

        /* –ò–Ω—Ñ–æ */
        .info-card { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 10px; border: 1px solid var(--border); }
        .news-item { font-size: 13px; color: #bbb; padding: 8px 0; border-bottom: 1px solid #222; }
        .back { color: var(--accent); font-weight: bold; margin-bottom: 15px; cursor: pointer; display: block; }
    </style>
</head>
<body>

    <div id="scr-main" class="screen active">
        <h1 style="font-size: 28px; margin-bottom: 25px;">SMC <span style="color:var(--accent)">QUANTUM</span></h1>
        <button class="btn-main" onclick="nav('scr-analysis')">üîç –í–´–ü–û–õ–ù–ò–¢–¨ –ê–ù–ê–õ–ò–ó <span>‚Üí</span></button>
        <button class="btn-main" style="border-left-color: var(--red)" onclick="nav('scr-info')">üåç –ò–ù–§–û –ò –ù–û–í–û–°–¢–ò <span>‚Üí</span></button>
        
        <div style="display: flex; gap: 10px; margin-top: 10px;">
            <button class="btn-sub" onclick="nav('scr-terminal')">üìä –¢–ï–†–ú–ò–ù–ê–õ</button>
            <button class="btn-sub" onclick="nav('scr-calendar')">üìÖ –ö–ê–õ–ï–ù–î–ê–†–¨</button>
        </div>
    </div>

    <div id="scr-terminal" class="screen">
        <span class="back" onclick="nav('scr-main')">‚Üê –ù–ê–ó–ê–î</span>
        <div id="tv-chart"></div>
        <textarea class="notes" id="note-box" placeholder="–ó–∞–º–µ—Ç–∫–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è..." oninput="localStorage.setItem('smc_note', this.value)"></textarea>
    </div>

    <div id="scr-calendar" class="screen">
        <span class="back" onclick="nav('scr-main')">‚Üê –ù–ê–ó–ê–î</span>
        <div class="info-card">
            <h3>–Ø–Ω–≤–∞—Ä—å 2026</h3>
            <div id="cal-render" class="cal-grid"></div>
        </div>
    </div>

    <div id="scr-info" class="screen" style="overflow-y: auto;">
        <span class="back" onclick="nav('scr-main')">‚Üê –ù–ê–ó–ê–î</span>
        
        <div class="info-card">
            <small style="color: #888;">FEAR & GREED INDEX</small>
            <div id="fng-val" style="font-size: 24px; font-weight: bold; color: var(--accent);">...</div>
        </div>

        <div class="info-card">
            <small style="color: #888;">TRUMP NEWS (AUTO-PARSED)</small>
            <div id="trump-feed"></div>
        </div>
    </div>

    <div id="scr-analysis" class="screen">
        <span class="back" onclick="nav('scr-main')">‚Üê –û–¢–ú–ï–ù–ê</span>
        <div class="info-card" style="text-align: center; margin-top: 50px;">
            <h2>–ê–Ω–∞–ª–∏–∑ 4H</h2>
            <p style="color: #888;">–í—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã?</p>
            <button class="btn-main" style="width:100%; text-align:center; background:var(--accent); color:#000;" onclick="submitAnalysis()">–ü–û–î–¢–í–ï–†–î–ò–¢–¨</button>
        </div>
    </div>

    <script src="https://s3.tradingview.com/tv.js"></script>
    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const params = new URLSearchParams(window.location.search);
        const history = (params.get('dates') || "").split(',');
        const trumpPosts = (params.get('posts') || "").split('|');

        function nav(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');

            if(id === 'scr-terminal') {
                new TradingView.widget({
                    "autosize": true, "symbol": "BINANCE:BTCUSDT", "interval": "15",
                    "theme": "dark", "container_id": "tv-chart", "hide_top_toolbar": false,
                    "withdateranges": true, "allow_symbol_change": true
                });
                document.getElementById('note-box').value = localStorage.getItem('smc_note') || '';
            }
            if(id === 'scr-calendar') renderCalendar();
            if(id === 'scr-info') {
                loadFNG();
                renderTrump();
            }
        }

        function renderCalendar() {
            const grid = document.getElementById('cal-render');
            grid.innerHTML = '';
            const now = new Date();
            const days = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            for(let i=1; i<=days; i++) {
                const dateStr = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}-${i.toString().padStart(2,'0')}`;
                let cls = history.includes(dateStr) ? 'day done' : 'day';
                grid.innerHTML += `<div class="${cls}">${i}</div>`;
            }
        }

        function loadFNG() {
            fetch('https://api.alternative.me/fng/').then(r => r.json()).then(d => {
                document.getElementById('fng-val').innerText = d.data[0].value + ' (' + d.data[0].value_classification + ')';
            });
        }

        function renderTrump() {
            const f = document.getElementById('trump-feed');
            f.innerHTML = trumpPosts.map(p => `<div class="news-item">üîπ ${p}</div>`).join('');
        }

        function submitAnalysis() {
            tg.sendData(JSON.stringify({action: 'analysis_done'}));
            tg.close();
        }
    </script>
</body>
</html>