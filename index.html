<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMC System</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #0b0e11; --card: #161a1e; --accent: #f0b90b; --green: #0ecb81; --red: #f6465d; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; padding: 15px; }
        
        .screen { display: none; }
        .screen.active { display: block; }

        .btn-nav { 
            background: #2b3139; color: white; border: 1px solid #474d57; 
            width: 100%; height: 80px; border-radius: 12px; 
            font-size: 18px; font-weight: bold; margin-bottom: 15px; cursor: pointer;
        }
        .card { background: var(--card); border: 1px solid #2b3139; border-radius: 10px; padding: 15px; margin-bottom: 10px; }
        #chart { height: 300px; border-radius: 10px; border: 1px solid #2b3139; }
        .step-btn { background: var(--accent); color: black; border: none; padding: 15px; width: 100%; border-radius: 10px; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="main-menu" class="screen active">
        <h2 style="text-align: center;">SMC TERMINAL</h2>
        <button class="btn-nav" onclick="show('terminal-screen')">üìä –¢–ï–†–ú–ò–ù–ê–õ</button>
        <button class="btn-nav" onclick="show('analysis-screen')">üîç –ê–ù–ê–õ–ò–ó (4H)</button>
    </div>

    <div id="terminal-screen" class="screen">
        <button onclick="show('main-menu')" style="color:var(--accent); background:none; border:none; padding:10px;">‚Üê –ù–ê–ó–ê–î</button>
        <div id="chart"></div>
        <div class="card" style="margin-top:10px;">
            <div style="display: flex; justify-content: space-between;">
                <span>SIDE: <b id="side-val">-</b></span>
                <span>ENTRY: <b id="entry-val">0.00</b></span>
            </div>
        </div>
    </div>

    <div id="analysis-screen" class="screen">
        <button onclick="show('main-menu')" style="color:var(--accent); background:none; border:none; padding:10px;">‚Üê –ù–ê–ó–ê–î</button>
        <div id="a-step-1" class="card">
            <p>–í—ã–ø–æ–ª–Ω–∏–ª–∏ –∞–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã?</p>
            <button class="step-btn" onclick="next(2)">–î–ê, –ò–î–ï–ú –î–ê–õ–¨–®–ï</button>
        </div>
        <div id="a-step-2" class="card" style="display:none;">
            <p>–§–∞–∑–∞ —Ä—ã–Ω–∫–∞ 4H:</p>
            <button class="step-btn" onclick="send('–ö–æ—Ä—Ä–µ–∫—Ü–∏—è 4H', '–û–∂–∏–¥–∞–Ω–∏–µ')">–ö–û–†–†–ï–ö–¶–ò–Ø</button>
            <button class="step-btn" style="background:#0ecb81" onclick="next(3)">–ò–ú–ü–£–õ–¨–°</button>
        </div>
        <div id="a-step-3" class="card" style="display:none;">
            <p>–í—Ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω?</p>
            <button class="step-btn" style="background:#0ecb81" onclick="send('–ò–º–ø—É–ª—å—Å 4H', '–ü–æ–∏—Å–∫ –≤—Ö–æ–¥–∞')">–î–ê</button>
            <button class="step-btn" onclick="send('–ò–º–ø—É–ª—å—Å 4H', '–û–∂–∏–¥–∞–Ω–∏–µ')">–ù–ï–¢</button>
        </div>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        function show(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'terminal-screen') {
                new TradingView.widget({
                    "autosize": true, "symbol": "BINANCE:BTCUSDT", "interval": "15",
                    "theme": "dark", "container_id": "chart", "hide_top_toolbar": true
                });
            }
        }

        function next(step) {
            document.getElementById('a-step-1').style.display = 'none';
            document.getElementById('a-step-2').style.display = 'none';
            document.getElementById('a-step-3').style.display = 'none';
            document.getElementById('a-step-' + step).style.display = 'block';
        }

        function send(p, s) {
            tg.sendData(JSON.stringify({type: 'analysis', phase: p, status: s}));
            tg.close();
        }

        const urlParams = new URLSearchParams(window.location.search);
        document.getElementById('side-val').innerText = urlParams.get('side') || 'WAIT';
        document.getElementById('entry-val').innerText = urlParams.get('entry') || '0.00';
    </script>
</body>
</html>