<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #000; --card: #111; --accent: #f0b90b; --red: #ff4444; --border: #222; }
        body { background: var(--bg); color: #fff; font-family: -apple-system, sans-serif; margin: 0; padding: 0; height: 100vh; overflow: hidden; }
        .screen { display: none; flex-direction: column; height: 100vh; padding: 10px; box-sizing: border-box; overflow-y: auto; }
        .active { display: flex; }

        /* Status Bar */
        .trade-status { background: #0a0a0a; border: 1px solid var(--accent); border-radius: 12px; padding: 12px; margin-bottom: 15px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; text-align: center; }
        .trade-status div { font-size: 10px; color: #666; }
        .trade-status b { display: block; font-size: 15px; color: var(--accent); margin-top: 4px; }

        /* Buttons */
        .btn-main { background: var(--card); border: 1px solid var(--border); color: #fff; padding: 18px; border-radius: 12px; margin-bottom: 10px; font-weight: bold; text-align: left; display: flex; justify-content: space-between; border-left: 5px solid var(--accent); width: 100%; font-size: 15px; cursor: pointer; }
        
        /* Calendar */
        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
        .day { aspect-ratio: 1; background: #0a0a0a; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 11px; border: 1px solid #1a1a1a; color: #444; }
        .day.done { background: var(--red) !important; color: #fff; border: none; box-shadow: 0 0 10px var(--red); font-weight: bold; }
        .day.today { border: 1px solid var(--accent); color: var(--accent); }

        /* Info & Terminal */
        .widget-box { background: var(--card); border-radius: 15px; border: 1px solid var(--border); overflow: hidden; margin-bottom: 15px; height: 450px; position: relative; }
        .trump-post { background: #050505; border-left: 3px solid #333; padding: 12px; margin-bottom: 8px; font-size: 13px; color: #eee; border-radius: 0 8px 8px 0; }
        .back { color: var(--accent); font-weight: bold; margin-bottom: 15px; display: block; cursor: pointer; }
        
        #tv-chart { flex-grow: 1; border: 1px solid var(--border); border-radius: 12px; min-height: 350px; }
        .notes { background: #000; border: 1px solid var(--border); color: #fff; padding: 10px; height: 60px; border-radius: 8px; margin-top: 10px; width: 100%; box-sizing: border-box; resize: none; font-size: 12px; }
    </style>
</head>
<body>

    <div id="scr-main" class="screen active">
        <h1 style="font-size: 24px; margin: 15px 0;">SMC <span style="color:var(--accent)">QUANTUM</span></h1>
        
        <div class="trade-status">
            <div>SIDE<b>LONG</b></div>
            <div>ENTRY<b>69,120</b></div>
            <div>STATUS<b>WAIT</b></div>
        </div>

        <button class="btn-main" onclick="nav('scr-analysis')">üîç –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ 4H <span>‚Üí</span></button>
        <button class="btn-main" style="border-left-color: var(--red)" onclick="nav('scr-info')">üåç –ù–û–í–û–°–¢–ò –ò –¢–†–ê–ú–ü <span>‚Üí</span></button>
        
        <div style="display: flex; gap: 8px;">
            <button style="flex:1;" class="btn-main" onclick="nav('scr-terminal')">üìä CHART</button>
            <button style="flex:1;" class="btn-main" onclick="nav('scr-calendar')">üìÖ CAL</button>
        </div>
    </div>

    <div id="scr-terminal" class="screen">
        <span class="back" onclick="nav('scr-main')">‚Üê BACK</span>
        <div id="tv-chart"></div>
        <textarea class="notes" id="note-box" placeholder="HTF Context / LTF Entry..." oninput="localStorage.setItem('smc_note', this.value)"></textarea>
    </div>

    <div id="scr-calendar" class="screen">
        <span class="back" onclick="nav('scr-main')">‚Üê BACK</span>
        <div style="background:var(--card); padding:15px; border-radius:15px; border:1px solid var(--border);">
            <div class="cal-header">
                <button onclick="changeMonth(-1)" style="color:#fff; background:none; border:none; font-size:20px;">‚ùÆ</button>
                <b id="month-name"></b>
                <button onclick="changeMonth(1)" style="color:#fff; background:none; border:none; font-size:20px;">‚ùØ</button>
            </div>
            <div id="cal-render" class="cal-grid"></div>
        </div>
    </div>

    <div id="scr-info" class="screen">
        <span class="back" onclick="nav('scr-main')">‚Üê BACK</span>
        
        <div class="widget-box" id="econ-calendar-container">
            </div>

        <div style="margin-top: 10px;">
            <small style="color:var(--accent); text-transform: uppercase; font-weight: bold;">Trump Statements</small>
            <div id="trump-feed" style="margin-top: 10px;"></div>
        </div>
    </div>

    <div id="scr-analysis" class="screen">
        <span class="back" onclick="nav('scr-main')">‚Üê BACK</span>
        <div style="background:var(--card); padding:25px; border-radius:20px; text-align:center; border:1px solid #333; margin-top: 20%;">
            <h2>Daily Analysis</h2>
            <p style="color: #888;">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–∑–±–æ—Ä–∞?</p>
            <button id="conf-btn" class="btn-main" style="background:var(--accent); color:#000; justify-content:center; border:none;" onclick="handleConfirm()">–î–ê, –í–´–ü–û–õ–ù–ï–ù–û</button>
            <p id="conf-msg" style="display:none; color:var(--accent); font-weight:bold;">–ú–ì–ù–û–í–ï–ù–ù–û –°–û–•–†–ê–ù–ï–ù–û ‚úÖ</p>
        </div>
    </div>

    <script src="https://s3.tradingview.com/tv.js"></script>
    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let currentDate = new Date();
        const params = new URLSearchParams(window.location.search);
        let history = (params.get('dates') || "").split(',').filter(d => d !== "");
        const trumpPosts = (params.get('posts') || "").split('|');

        function nav(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            if(id === 'scr-terminal') {
                new TradingView.widget({
                    "autosize": true, "symbol": "BINANCE:BTCUSDT", "interval": "15",
                    "theme": "dark", "container_id": "tv-chart", "hide_top_toolbar": false,
                    "locale": "ru"
                });
            }
            if(id === 'scr-calendar') renderCalendar();
            if(id === 'scr-info') {
                renderTrump();
                initEconWidget();
            }
        }

        // –†–µ–Ω–¥–µ—Ä –≤–∏–¥–∂–µ—Ç–∞ –ë–ï–ó –æ—à–∏–±–æ–∫ –¥–≤–æ–µ—Ç–æ—á–∏—è (—á–µ—Ä–µ–∑ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç)
        function initEconWidget() {
            const container = document.getElementById('econ-calendar-container');
            container.innerHTML = '';
            const script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-events.js';
            script.async = true;
            script.text = JSON.stringify({
                colorTheme: "dark",
                isMaximized: true,
                width: "100%",
                height: "100%",
                locale: "ru",
                importanceFilter: "-1,0,1",
                currencyFilter: "USD,EUR"
            });
            container.appendChild(script);
        }

        function renderCalendar() {
            const grid = document.getElementById('cal-render');
            grid.innerHTML = '';
            const y = currentDate.getFullYear(), m = currentDate.getMonth();
            document.getElementById('month-name').innerText = new Intl.DateTimeFormat('ru-RU', {month:'long', year:'numeric'}).format(currentDate);

            const firstDay = new Date(y, m, 1).getDay();
            const daysInMonth = new Date(y, m + 1, 0).getDate();
            const offset = firstDay === 0 ? 6 : firstDay - 1;

            for(let i=0; i<offset; i++) grid.innerHTML += '<div></div>';
            for(let d=1; d<=daysInMonth; d++) {
                const dStr = `${y}-${(m+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`;
                const done = history.includes(dStr) ? 'done' : '';
                const today = new Date().toISOString().slice(0,10) === dStr ? 'today' : '';
                grid.innerHTML += `<div class="day ${done} ${today}">${d}</div>`;
            }
        }

        function changeMonth(s) { currentDate.setMonth(currentDate.getMonth() + s); renderCalendar(); }

        function renderTrump() {
            const c = document.getElementById('trump-feed');
            c.innerHTML = trumpPosts.map(p => p.length > 5 ? `<div class="trump-post">üîπ ${p}</div>` : '').join('');
        }

        function handleConfirm() {
            const today = new Date().toISOString().slice(0,10);
            if(!history.includes(today)) history.push(today);
            renderCalendar();
            document.getElementById('conf-btn').style.display = 'none';
            document.getElementById('conf-msg').style.display = 'block';
            tg.sendData(JSON.stringify({action: 'analysis_done', date: today}));
            setTimeout(() => { tg.close(); }, 1000);
        }

        document.getElementById('note-box').value = localStorage.getItem('smc_note') || '';
    </script>
</body>
</html>